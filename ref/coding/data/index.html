<!DOCTYPE html> <html lang="en"> <head> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title>data | ST</title> <meta name="author" content="Sean Trautman"/> <meta name="description" content="Intro to Data Analysis"/> <meta name="keywords" content="jekyll, jekyll-theme, academic-website, portfolio-website"/> <link href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha256-DF7Zhf293AJxJNTmh5zhoYYIMs2oXitRfBjY+9L//AY=" crossorigin="anonymous"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous"/> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.4/css/all.min.css" integrity="sha256-mUZM63G8m73Mcidfrv5E+Y61y7a12O5mW4ezU3bxqW4=" crossorigin="anonymous"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/academicons@1.9.1/css/academicons.min.css" integrity="sha256-i1+4qU2G2860dGGIOJscdC30s9beBXjFfzjWLjBRsBg=" crossorigin="anonymous"> <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/jwarby/jekyll-pygments-themes@master/native.css" media="" id="highlight_theme_light"/> <link rel="shortcut icon" href="/assets/img/st-logo-transparent.png"/> <link rel="stylesheet" href="/assets/css/main.css"> <link rel="canonical" href="https://straut12.github.io/ref/coding/data/"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/jwarby/jekyll-pygments-themes@master/native.css" media="none" id="highlight_theme_dark"/> <script src="/assets/js/theme.js"></script> <script src="/assets/js/dark_mode.js"></script> </head> <body class="fixed-top-nav "> <div class="site-container"> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top"> <div class="container"> <a class="navbar-brand title font-weight-lighter" href="/">ST</a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link" href="/"></a> </li> <li class="nav-item dropdown "> <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Coding</a> <div class="dropdown-menu dropdown-menu-right" aria-labelledby="navbarDropdown"> <a class="dropdown-item" href="/ref/coding/git/">VScode Github</a> <div class="dropdown-divider"></div> <a class="dropdown-item" href="/ref/coding/bash/">Bash Shell</a> <div class="dropdown-divider"></div> <a class="dropdown-item" href="/ref/coding/python/">Python</a> <div class="dropdown-divider"></div> <a class="dropdown-item" href="/ref/coding/js/">JavaScript</a> <div class="dropdown-divider"></div> <a class="dropdown-item" href="/ref/coding/html/">Web HTML</a> </div> </li> <li class="nav-item dropdown "> <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Data Analysis</a> <div class="dropdown-menu dropdown-menu-right" aria-labelledby="navbarDropdown"> <a class="dropdown-item" href="/ref/data-analysis/data-collection/">data collection</a> <div class="dropdown-divider"></div> <a class="dropdown-item" href="/ref/data-analysis/databases/">databases</a> <div class="dropdown-divider"></div> <a class="dropdown-item" href="/ref/data-analysis/basic-charting/">basic charting</a> <div class="dropdown-divider"></div> <a class="dropdown-item" href="/ref/data-analysis/data-visualization/">data visualization</a> <div class="dropdown-divider"></div> <a class="dropdown-item" href="/ref/data-analysis/ml/">machine learning</a> <div class="dropdown-divider"></div> <a class="dropdown-item" href="/ref/data-analysis/statistics/">notes</a> </div> </li> <li class="nav-item dropdown "> <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Linux</a> <div class="dropdown-menu dropdown-menu-right" aria-labelledby="navbarDropdown"> <a class="dropdown-item" href="/ref/linux/linuxdistros/">Linux Options</a> <div class="dropdown-divider"></div> <a class="dropdown-item" href="/ref/linux/desktop/">Desktop Appearance</a> <div class="dropdown-divider"></div> <a class="dropdown-item" href="/ref/linux/software/">Installing SW</a> <div class="dropdown-divider"></div> <a class="dropdown-item" href="/ref/linux/sharing/">File Sharing</a> <div class="dropdown-divider"></div> <a class="dropdown-item" href="/ref/linux/vnc-ssh/">Remote vnc ssh</a> <div class="dropdown-divider"></div> <a class="dropdown-item" href="/ref/linux/terminal/">Terminal cli</a> <div class="dropdown-divider"></div> <a class="dropdown-item" href="/ref/linux/autostart/">Autostart systemd</a> <div class="dropdown-divider"></div> <a class="dropdown-item" href="/ref/linux/logs/">Logs</a> <div class="dropdown-divider"></div> <a class="dropdown-item" href="/ref/linux/list/">List of SW to Install</a> </div> </li> <li class="nav-item "> <a class="nav-link" href="/repositories/">Repositories</a> </li> <li class="toggle-container"> <button id="light-toggle" title="Change theme"> <i class="fas fa-moon"></i> <i class="fas fa-sun"></i> </button> </li> </ul> </div> </div> </nav> <progress id="progress" value="0"> <div class="progress-container"> <span class="progress-bar"></span> </div> </progress> </header> <div class="site-body wrapper"> <aside class="site-sidebar" id="site-sidebar"> <nav class="toc"> <header><h4 class="toc__title">Table of Contents</h4></header> <ul class="toc__menu"> <li> <a href="#mqtt">MQTT</a> <ul> <li><a href="#paho-python">PAHO Python</a></li> <li><a href="#umqttsimple-upython">Umqttsimple uPython</a></li> </ul> </li> <li><a href="#node-red">Node Red</a></li> <li> <a href="#databases">Databases</a> <ul> <li><a href="#influxdb">Influxdb</a></li> <li><a href="#mariadb">MariaDB</a></li> <li><a href="#ms-access">MS Access</a></li> </ul> </li> <li> <a href="#basic-charting">Basic Charting</a> <ul> <li><a href="#node-red-chartsgauges">Node-Red Charts/Gauges</a></li> <li><a href="#grafana">Grafana</a></li> </ul> </li> <li> <a href="#advanced-data-visualization">Advanced Data Visualization</a> <ul> <li><a href="#pandas">Pandas</a></li> <li><a href="#python-in-excel">Python In Excel</a></li> <li><a href="#jupyter-notebook">Jupyter Notebook</a></li> <li><a href="#dash-plotly">Dash-plotly</a></li> <li><a href="#power-bi">Power BI</a></li> </ul> </li> <li> <a href="#workflow">Workflow</a> <ul> <li><a href="#hardware">Hardware</a></li> <li><a href="#coding">Coding</a></li> <li><a href="#mqttserversdb">MQTT/Servers/DB</a></li> <li><a href="#esp32upython">esp32/uPython</a></li> <li><a href="#run-at-startup">Run at Startup</a></li> <li><a href="#git-branches">​Git branches</a></li> <li><a href="#copy-project">Copy Project</a></li> <li><a href="#create-python-package">Create Python Package</a></li> </ul> </li> </ul> </nav> </aside> <main> <div class="post"> <p class="post-description">Intro to Data Analysis</p> <article> <p>As you start working on STEM project you’ll quickly run into the scenario where you want one device (ie an ESP32 microcontroller) to send data and receive commands from another device (ie a Raspberry Pi or your phone). A simple way to do this is with a MQTT-Node-Red server running on a RPi. You can also add a database (ie Influxdb) to save data for charting in Node-red or Grafana. Data analysis involves measuring, transferring, visualizing, and analyzing the data. Below are tools that I have tried out. There are obviously many more options (ie google data studio) these are just the tools I’ve found easy to learn and useful.</p> <ol> <li>MQTT - Sends data/commands between devices (remote machines and a server)</li> <li>Influxdb(sql) - Store the data in a time based database</li> <li>NodeRed(javascript) - Receives the data from mqtt and stores it to the influxdb. Has a gui dashboard with gauges or you can retrieve historical data and chart it. Javascript functions can be written to handle the data flow.</li> </ol> <h1 id="mqtt">MQTT</h1> <p><a href="https://mosquitto.org/" target="_blank" rel="noopener noreferrer">Mosquitto</a> MQTT is a lightweight messaging protocol that simplifies sending/receiving messages between devices (messages can be in the form of JSON objects). It acts as a broker to handle mqtt traffic among your devices. The messages are organized by topics. By publishing and subscribing to topics devices are able to talk to each other. For example, you can send commands from a node-red dashboard (web based), via the mqtt broker, to a RPi/esp32 to control servos or motors. And in return the the RPi/esp32 can send status (rpms) or other sensor data (voltage, current, temp) back to the node-red dashboard. The mqtt broker can run on the same RPi involved in the project or on a standalone RPi. The RPi can acts as the mqtt server/broker with node-red as the “brains”.​ Another example might be collecting the water level of a tank with a sensor and turning a pump off when sensor shows level is high.</p> <p>Measuring/Sending Data from a esp32/esp8266 or raspberry pi <br> Data collection can be made through sensors or other instruments</p> <ul> <li>ADC, ina219 current sensor, DHT11 temp sensor, encoder (motor rpm), etc</li> <li>I then use mosquitto (mqtt) to send the data to a server (usually a raspberry pi) and store it in a database (usually influxdb)</li> </ul> <blockquote> <p>Note - When possible I give each pi a unique name during setup and use hostname.local or just hostname instead of IP address. Using the raw IP address can be problematic due to it changing.​​ Static IP can also be a hassle since you’ll have to make sure your router doesn’t assign that ip address to another machine when it is offline.</p> </blockquote> <p>Mosquitto documentation can be found at mosquitto.org/man/. It’s a good reference tool for looking at the publish and subscribe functions. (Mosquitto uses port 1883)<br> ​ Initial setup on the device that will be used as the broker (mqtt server). You will use it both as the broker and client for initial testing.<br> <code class="language-plaintext highlighter-rouge">sudo apt install mosquitto mosquitto-clients</code><br> Now run an initial test. Since the subscribe/publish are happening on the broker you do not need to include the broker IP address.<br> In one window subscribe to “test” topic (-t)<br> <code class="language-plaintext highlighter-rouge">mosquitto_sub -t "test"</code> <br> In another window publish a msg (-m) to “test”topic (-t)<br> <code class="language-plaintext highlighter-rouge">mosquitto_pub -m "msg from window2" -t "test"</code><br> You should see the message show up on the first window</p> <p>Now add a password file. I called my file “passwd” and put it in /etc/mosquitto<br> <code class="language-plaintext highlighter-rouge">sudo mosquitto_passwd -c /etc/mosquitto/passwd &lt;user&gt;</code></p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">Password: &lt;enter a password&gt;</span><span class="w">
</span></code></pre></div></div> <p>Check the status with <code class="language-plaintext highlighter-rouge">$ systemctl status mosquitto</code><br> The newer version requires a port defined for listening. You can add this in the user config file below <code class="language-plaintext highlighter-rouge">sudo nano /etc/mosquitto/conf.d/user.conf</code></p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="go">listener 1883
</span></code></pre></div></div> <p>Note - If you look at <code class="language-plaintext highlighter-rouge">sudo nano /etc/mosquitto/The mosquitto.conf</code> it states it will also read user config in /etc/mosquitto/conf.d/ directory.</p> <p>If running the older version of mosquitto it opens port 1883 automatically and will shown in <code class="language-plaintext highlighter-rouge">systemctl status mosquitto</code></p> <p>To check that port 1883 is listening run <code class="language-plaintext highlighter-rouge">sudo lsof -i -P -n | grep LISTEN</code></p> <p>You can also tell mosquitto where the password file is by updating the user.conf file<br> <code class="language-plaintext highlighter-rouge">sudo nano /etc/mosquitto/conf.d/user.conf</code></p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="go">listener 1883
allow_anonymous false
password_file /etc/mosquitto/passwd
</span></code></pre></div></div> <p>Now test again but this time you’ll have to include your user (-u) and password (-P).<br> First window<br> <code class="language-plaintext highlighter-rouge">mosquitto_sub -t "test" -u "user" -P "password"</code> <br> Second window<br> <code class="language-plaintext highlighter-rouge">mosquitto_pub -m "msg from window2" -t "test" -u "user" -P "password"</code></p> <p>Enable mosquitto to start on boot<br> <code class="language-plaintext highlighter-rouge">sudo systemctl enable mosquitto</code></p> <p>Additional testing -</p> <p>Default QOS (quality of services) is 0 which has no confirmation that the msg was received. Testing can be done with QOS=1 to get confirmation that the messag was received.<br> -V to use mqttv311 and -d for debugging<br> <code class="language-plaintext highlighter-rouge">mosquitto_sub -V mqttv311 -t "test" -u "user" -P "password" -q1 -d</code><br> Now publish a msg<br> <code class="language-plaintext highlighter-rouge">mosquitto_pub -V mqttv311 -t "test" -m "message" -u "user" -P "password" -q 1 -d</code></p> <p>If you have a second device you can try sending a msg from it to the broker. Now you’ll need to specify the IP address of the broker (-h) so mosquitto knows where to send the msg.<br> <code class="language-plaintext highlighter-rouge">mosquitto_pub -h &lt;Broker IPaddress&gt; -m "msg device2" -t "test" -u "user" -P "password"</code></p> <h2 id="paho-python">PAHO Python</h2> <p>RPi mqtt/Python specific libraries - <a href="https://eclipse.dev/paho/index.php?page=clients/python/docs/index.php" target="_blank" rel="noopener noreferrer">Paho Python client</a> makes it easy to setup the RPi broker functionality. It includes functions for connecting to the broker, sending and receiving messages.<br> install in venv <code class="language-plaintext highlighter-rouge">(.venv)$ python3.7 -m pip install paho-mqtt</code></p> <h2 id="umqttsimple-upython">Umqttsimple uPython</h2> <p>esp32 mqtt/upython specific libraries - Umqttsimple makes it easy to setup ESP32 communication to the RPi mqtt broker using upython. It also includes functions for connecting to the broker, sending and receiving messages.</p> <p>On the esp32 you will copy over a umqttsimple.py file along with your boot.py and main.py. You then import it with</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="go">from umqttsimple import MQTTClient
</span></code></pre></div></div> <p>The umqttsimple.py code can also be found in github for MQTT projects</p> <h1 id="node-red">Node Red</h1> <p><a href="https://nodered.org/" target="_blank" rel="noopener noreferrer">Node Red</a> is a flow-based coding tool. It has a web browser-based editor where you connect different nodes to retrieve data, store data, make decisions, etc. A common setup is to use the ‘mqtt in’ node to listen for messages/data. Then, based on the mqtt message content (JSON format), other nodes can be connected to store the data in a database, send data to gauges/charts, use a ‘mqtt out’ node to send instructions (publish) to another microcontroller. To program node-red you can use both the built-in nodes or code-blocks with custom javascript code/functions. Using json along with loads/dumps makes it easy to transfer data between Python running on your microcontroller and node-red js.</p> <p>Although node-red is installed on RPi’s the node-red web site recommends using their script to setup on a RPi.<br> <code class="language-plaintext highlighter-rouge">sudo apt install build-essential git</code><br> <code class="language-plaintext highlighter-rouge">bash &lt;(curl -sL https://raw.githubusercontent.com/node-red/linux-installers/master/deb/update-nodejs-and-nodered) </code><br> On Pi Node-RED works better with the Firefox or Chrome browser<br> <code class="language-plaintext highlighter-rouge">node-red-stop</code> to stop Node-RED<br> <code class="language-plaintext highlighter-rouge">node-red-start</code> to start Node-RED again<br> <code class="language-plaintext highlighter-rouge">node-red-log</code> to view the recent log output<br> <code class="language-plaintext highlighter-rouge">sudo systemctl enable nodered</code> to autostart Node-RED at every boot<br> <code class="language-plaintext highlighter-rouge">sudo systemctl disable nodered</code> to disable autostart on boot</p> <p><code class="language-plaintext highlighter-rouge">sudo reboot</code><br> To setup your node red flows go to <strong>http://hostname.local:1880</strong> (IP add = the address of RPi) on any device connected to the network.<br> For influxdb and gauges/charts options go to menu in upper right and “manage pallette” then install</p> <ul> <li>influxdb</li> <li>node red dashboard</li> </ul> <p>Dashboard<br> Once you have gauges/charts setup you can view them at <strong>http://hostname.local:1880/ui</strong></p> <p><strong>Grafana</strong><br> Most of the graphing I do is in node-red because it’s convenient to setup while working on the main flow and the graphs are compact (look nice on mobile browser). But grafana is useful when you want the ability to zoom in closer and do more analysis. It also has functions to alert you based on conditions you configure.</p> <p>Installation<br> Prerequisites<br> <code class="language-plaintext highlighter-rouge">sudo apt-get install -y apt-transport-https</code><br> <code class="language-plaintext highlighter-rouge">sudo apt-get install -y software-properties-common wget</code></p> <p>Add APT key used for authenticating the grafana package<br> wget -q -O - https://packages.grafana.com/gpg.key | sudo apt-key add - Add the grafana repository to your sources.list echo “deb https://packages.grafana.com/oss/deb stable main” | sudo tee -a /etc/apt/sources.list.d/grafana.list Download package information from the updated sources and install grafana sudo apt update sudo apt install grafana Start the grafana server and enable it to start on boot sudo systemctl start grafana-server sudo systemctl enable grafana-server Grafana runs on port 3000 so you can configure your database by going to http://hostname.local:3000 Initial login is admin/admin. Configuration file is in /etc/grafana/grafana.ini</p> <p>Add your first data source (influxDB)</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>InfluxQL
URL: http://localhost:8086
Add a database
Save and Test
</code></pre></div></div> <p>​Create/add panels in your dashboard</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Click on the title and edit (example below)
FROM autogen mydb WHERE device = mcp3008
SELECT field (a0f)
On far right click "Show options" and then Visualation drop down to change graph type to gauge or bar, etc.
Upper right in the referesh bar you can select 5s auto refresh (can't go smaller).
</code></pre></div></div> <p>Adding plugin panels (ie plotly) To avoid write permissions I used sudo which forced chown/chmod on the plugin files. There is a better way to do this.. but this is what worked for me. $ sudo grafana-cli plugins install <plugin-name> $ sudo chown -R grafana:grafana /var/lib/grafana/plugins $ sudo chmod -R 777 /var/lib/grafana/plugins (could try 742) $ service grafana-server restart Re open grafana and now panels were available</plugin-name></p> <h1 id="databases">Databases</h1> <h2 id="influxdb">Influxdb</h2> <p>Some database options</p> <ul> <li>influxdb (time series for monitoring measurements over time)</li> <li>mysql (relation based) Can be used to collect a set of measurements over varying conditions.</li> <li>Text, csv, excel file</li> <li>For time series data I usually use node-red (with its charting options) connected to influxdb<br> For experimental data I read a csv using Jupyter Notebook or dash plotted by plotly</li> </ul> <p><a href="https://www.influxdata.com/" target="_blank" rel="noopener noreferrer">Influxdb</a> is a time series database (the time stamp is automatically added to the data when storing). It does not require a schema so it is a quick and easy install for collecting data over time. Node-red can store data in the influxdb and retrieve data for charting. (port 8086 used for communication)</p> <ul> <li><a href="https://docs.influxdata.com/influxdb/v2.0/reference/key-concepts/design-principles/" target="_blank" rel="noopener noreferrer">Design Principles</a></li> <li><a href="https://docs.influxdata.com/influxdb/v2.0/reference/key-concepts/data-elements/" target="_blank" rel="noopener noreferrer">Explanation of Data Elements</a></li> </ul> <p>Field - used to store the data and is required (not indexed)<br> Tags - descriptions of the data (metadata). Indexed to make data retrieval faster. Not required but recommended.<br> Measurement - similar to a table</p> <p>Note - with ver 1.8+ there is an alternate query option called flux and it differs quite a bit from InfluxQL syntax. The advantage is that flux provides a lot more options for querying and analyzing data. Some examples in my node-red will use flux instead of InfluxQL.</p> <p>Installation <br> Add the InfluxDB repository key so the RPi package manager is allowed to search that repository. The key gets passed into the gpg program and de-armored. Then saved into the /usr/share/keyrings/ directory.<br> <code class="language-plaintext highlighter-rouge">curl https://repos.influxdata.com/influxdb.key | gpg --dearmor | sudo tee /usr/share/keyrings/influxdb-archive-keyring.gpg &gt;/dev/null</code><br> <code class="language-plaintext highlighter-rouge">lsb_release -cs</code><br> Add influxDB repository to the sources list using signed-by. lsb_release -cs will automatically fill in the RPi version.<br> <code class="language-plaintext highlighter-rouge">echo "deb [signed-by=/usr/share/keyrings/influxdb-archive-keyring.gpg] https://repos.influxdata.com/debian $(lsb_release -cs) stable" | sudo tee /etc/apt/sources.list.d/influxdb.list</code></p> <p><code class="language-plaintext highlighter-rouge">sudo apt update</code> Update the package list. Should see influxdata added<br> Now install<br> <code class="language-plaintext highlighter-rouge">sudo apt install influxdb</code><br> <code class="language-plaintext highlighter-rouge">sudo systemctl unmask influxdb.service</code><br> <code class="language-plaintext highlighter-rouge">sudo systemctl enable influxdb </code><br> <code class="language-plaintext highlighter-rouge">sudo systemctl start influxdb</code><br> <code class="language-plaintext highlighter-rouge">journalctl -u influxdb</code></p> <ul> <li>unmask allows all/any attempts to start the service</li> </ul> <p>​For node-red to pull data you need to enable HTTP authentication. With HTTP authentication enabled InfluxDB also requires you to create at least one admin user before you can interact with the system. Enter the influx interface by typing influx at a command line and then create an admin user/pswd.</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="go">influx 
</span><span class="gp">CREATE USER admin WITH PASSWORD '&lt;passwd&gt;</span><span class="s1">' WITH ALL PRIVILEGES 
</span><span class="go">show users 
exit 
</span></code></pre></div></div> <p>Now edit configuration file to enable HTTP authentication.<br> <code class="language-plaintext highlighter-rouge">sudo nano /etc/influxdb/influxdb.conf</code><br> Set HTTP service enabled and address</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="go">[http] 
enabled = true 
flux-enabled = true 
bind-address = ":8086" 
</span></code></pre></div></div> <p>*Note - After restarting influxdb service you may get “Failed to connect” if trying to enter REPL. It may take 5-15sec to setup and allow you back in.<br> <code class="language-plaintext highlighter-rouge">sudo systemctl restart influxdb</code><br> <code class="language-plaintext highlighter-rouge">influx -username admin -password &lt;passwd&gt;</code></p> <p>Helpful commands</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">&gt;</span><span class="w"> </span>CREATE DATABASE mydb
<span class="go">(will use default retention policy that equals shard group duration of 7 days. Data will be deleted after 7 days. Shard group is compressed data, stored in a TSM file.)

To use a different retnetion policy ..
</span><span class="gp">&gt;</span><span class="w"> </span>CREATE DATABASE mydb WITH DURATION 26w <span class="o">(</span>default shard <span class="k">for</span> +6mo of data is 1w<span class="o">)</span> 
<span class="gp">&gt;</span><span class="w"> </span>CREATE DATABASE mydb WITH DURATION 2w REPLICATION 1 SHARD DURATION 1w 
<span class="go">
</span><span class="gp">&gt;</span><span class="w"> </span>DROP DATABASE mydb <span class="o">(</span>to delete<span class="o">)</span> 
<span class="gp">&gt;</span><span class="w"> </span>SHOW DATABASES 
<span class="gp">&gt;</span><span class="w"> </span>USE mydb 
<span class="gp">&gt;</span><span class="w"> </span>SHOW MEASUREMENTS 
<span class="gp">&gt;</span><span class="w"> </span>SHOW SERIES 
<span class="gp">&gt;</span><span class="w"> </span>SELECT <span class="k">*</span> FROM measurement-name 
<span class="gp">&gt;</span><span class="w"> </span>SELECT <span class="k">*</span> FROM temperature 
<span class="gp">&gt;</span><span class="w"> </span>SELECT <span class="k">*</span> FROM <span class="s2">"temp"</span> WHERE <span class="s2">"value"</span> <span class="o">&gt;</span> 0 
<span class="gp">&gt;</span><span class="w"> </span>SELECT count<span class="o">(</span><span class="k">*</span><span class="o">)</span> FROM temperature<span class="p">;</span> <span class="o">(</span>will show how many recoreds <span class="k">in </span>MEASUREMENT temperature<span class="o">)</span> 
</code></pre></div></div> <p>To use influx cli at command prompt<br> <code class="language-plaintext highlighter-rouge">influx -execute 'SHOW DATABASES'</code></p> <p>To delete data</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">&gt;</span>use mydb
<span class="gp">&gt;</span><span class="w"> </span>delete from mydb where <span class="nb">time</span> <span class="o">&gt;</span> 161798006580600 and <span class="nb">time</span> &lt; 161798007032600
<span class="gp">&gt;</span><span class="w"> </span>delete from mydb where <span class="nb">time</span> <span class="o">=</span> 1617980056650000
<span class="gp">&gt;</span><span class="w"> </span>delete from mydb where tag <span class="o">=</span> <span class="s1">'value'</span> 
<span class="go">
Retention Policy and Shard. To alter the autogen RP on a db (autogen is the default RP used in nodered influx node)
</span><span class="gp">&gt;</span><span class="w"> </span>use mydb 
<span class="gp">&gt;</span><span class="w"> </span>ALTER RETENTION POLICY autogen ON mydb DURATION 2w REPLICATION 1 SHARD DURATION 1w 
<span class="gp">&gt;</span><span class="w"> </span>show retention policies 
<span class="gp">&gt;</span><span class="w"> </span>show shard <span class="nb">groups</span> 
</code></pre></div></div> <p>Sharding - facilitates horizontal scaling, or scaling out (vs vertical scaling). Allow for faster processing. Default shard groups based on RP duration. <br> Retention Policy’s DURATION – Shard Group Duration <br> &lt; 2 days – 1 hour<br> &gt;= 2 days and &lt;= 6 months – 1 day<br> &gt; 6 months – 7 days</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="go">CREATE RETENTION POLICY "52weeks" ON "mydb" DURATION 52w REPLICATION 1 DEFAULT
</span></code></pre></div></div> <p>creates an RP called 52weeks that exists in “mydb” database. 52w keeps data for a DURATION of 52w and it’s the DEFAULT RP for the database.<br> For testing</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="go">CREATE RETENTION POLICY "1d" ON "mydb" DURATION 1d REPLICATION 1
</span></code></pre></div></div> <p>will keep data for 1 day. Have 1 day to get the testing data retrieved and saved offline in a spreadsheet.</p> <p>To export a database/table(measurement) to a csv file<br> <code class="language-plaintext highlighter-rouge">influx -database 'database name' -execute "SELECT * FROM measurement" -format csv &gt; test.csv</code></p> <p>To backup/restore data<br> <code class="language-plaintext highlighter-rouge">sudo -u influxdb influxd backup -portable -host &lt;IPadd&gt;:8088 /path/to/backup/</code><br> <code class="language-plaintext highlighter-rouge">sudo -u influxdb influxd restore -portable -host &lt;IPadd&gt;:8088 /path/to/backup/</code></p> <p>To change the location where your data is stored<br> Create data and meta folders in the newlocation<br> Make influxdb owner of these new locations<br> <code class="language-plaintext highlighter-rouge">sudo chown -R influxdb:influxdb newlocation/influxdb/meta/</code><br> <code class="language-plaintext highlighter-rouge">sudo chown -R influxdb:influxdb newlocation/influxdb/data/</code><br> Update permission<br> <code class="language-plaintext highlighter-rouge">sudo chmod 777 -R data</code><br> <code class="language-plaintext highlighter-rouge">sudo chmod 777 -R meta</code></p> <p>changed folders in /etc/influxdb/influxdb.conf to /home/pi/influxdb (data and meta) along with IP address and under [http] at bottom enable=true for endpoint and bind-address = 8086</p> <h2 id="mariadb">MariaDB</h2> <p>Mariadb is based on mysql. Port 3306</p> <blockquote> <p>Note for remote connection from excel. Will need to configure mariadab config file by commenting out bind statement and add user privileges to all db and wild card host (see comments below). Also may need to install ODBC (Open DataBase Connectivity) connector from https://dev.mysql.com/downloads/connector/odbc/ and visual studio update. Then search/open up ODBC 64bit administrator and add MySQL ODBC 8.0 ANSI driver. Set up the connection and chose SQL server authentication.</p> </blockquote> <p>Run sudo apt update to update the package list</p> <ul> <li><code class="language-plaintext highlighter-rouge">sudo apt update</code></li> <li><code class="language-plaintext highlighter-rouge">sudo apt install mariadb-server</code></li> <li> <code class="language-plaintext highlighter-rouge">sudo mysql_secure_installation</code> utility<br> (options to allow for remote access on port 3306)<br> *<code class="language-plaintext highlighter-rouge">sudo mysql -u root -p</code> </li> <li><code class="language-plaintext highlighter-rouge">sudo ufw allow mysql</code></li> <li><code class="language-plaintext highlighter-rouge">sudo systemctl start mysql</code></li> <li> <code class="language-plaintext highlighter-rouge">sudo systemctl enable mysql</code><br> Config file is at /etc/mysql/mysql.conf.d/mysqld.cnf</li> </ul> <p>If you don’t run as sudo then the first time you get “MySQL ERROR” then run as sudo</p> <ul> <li> <code class="language-plaintext highlighter-rouge">$ sudo mysql</code><br> Then run alter command at mysql prompt<br> <code class="language-plaintext highlighter-rouge">sql mysql&gt; ALTER USER 'root'@'localhost' IDENTIFIED WITH mysql_native_password BY 'your_new_password';</code><br> CTRL-D to exit</li> </ul> <p>Create a db with <code class="language-plaintext highlighter-rouge">CREATE DATABASE name;</code><br> Then create a user and privileges<br> <code class="language-plaintext highlighter-rouge">CREATE USER 'username'@'localhost' IDENTIFIED BY 'password';</code></p> <p><code class="language-plaintext highlighter-rouge">GRANT ALL PRIVILEGES ON &lt;dbname&gt;.* TO 'username'@'localhost';</code><br> <code class="language-plaintext highlighter-rouge">FLUSH PRIVILEGES;</code></p> <p>Can check user login with same <code class="language-plaintext highlighter-rouge">sudo mysql -u user -p</code><br> To see users<br> <code class="language-plaintext highlighter-rouge">SELECT User, Host FROM mysql.user WHERE Host &lt;&gt; 'localhost';</code></p> <p>To grant remote access you wild card all db with * and use % to wild card IP addresses<br> <code class="language-plaintext highlighter-rouge">GRANT ALL PRIVILEGES ON *.* TO 'sj4u'@'192.168.100.%' IDENTIFIED BY 'password' WITH GRANT OPTION;</code></p> <p>Firewall config</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="go">firewall config  
firewall-cmd --add-port=3306/tcp 
firewall-cmd --permanent --add-port=3306/tcp
</span></code></pre></div></div> <p>Configuration file is in /etc/mysql/mariadb.conf.d/50-server.cnf<br> for remote access may need to update bind-address from 127.0.0.1 to 0.0.0.0 or comment it out<br> and add</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="go">skip-networking
skip-bind-address
</span></code></pre></div></div> <p>and restart with <code class="language-plaintext highlighter-rouge">sudo systemctl restart mysql.service</code><br> can see starting param with <code class="language-plaintext highlighter-rouge">mysqld --print-defaults</code></p> <p>or install PHPMyAdmin<br> <code class="language-plaintext highlighter-rouge">sudo apt install php libapache2-mod-php</code><br> <code class="language-plaintext highlighter-rouge">sudo apt install phpmyadmin</code><br> Select apache web server and say No to config with dbconfig-common</p> <p>Go to http://RPi-IPAddress/phpmyadmin<br> if you need to restart the server use <code class="language-plaintext highlighter-rouge">sudo service apache2 restart</code></p> <blockquote> <p>Test connection with <code class="language-plaintext highlighter-rouge">mysql --host=localhost --password='password' --protocol=tcp --port=3306 esp2nred </code></p> </blockquote> <p>Common mysql commands</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">SHOW DATABASES;</span><span class="w">
</span><span class="gp">USE &lt;database&gt;</span><span class="p">;</span>
<span class="gp">SHOW TABLES;</span><span class="w">
</span><span class="gp">SELECT * FROM &lt;table&gt;</span><span class="p">;</span>
<span class="go">UPDATE, INSERT, DELETE```

To import a csv (can also save a xls file as csv)  
Create a database and empty table with fields then import with the LOAD command.  
--local-infile may be needed  
</span><span class="gp">* ```$</span><span class="w"> </span>mysql <span class="nt">-u</span> root <span class="nt">-p</span> <span class="nt">--local-infile</span><span class="sb">```</span>  
<span class="go">```sql
</span><span class="gp">mysql&gt;</span><span class="w"> </span>CREATE DATABASE testdb<span class="p">;</span>
<span class="gp">mysql&gt;</span><span class="w"> </span>USE testdb<span class="p">;</span>
</code></pre></div></div> <p>Create the table/define schema using options below<br> A good example is in node-red</p> <div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">mysql</span><span class="o">&gt;</span> <span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">mytable</span> <span class="p">(</span>
<span class="s1">'no'</span> <span class="nb">INT</span> <span class="k">NULL</span> <span class="n">AUTO_INCREMENT</span><span class="p">,</span>
<span class="s1">'date'</span> <span class="nb">TIMESTAMP</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
<span class="n">field1</span> <span class="nb">INT</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="k">PRIMARY</span> <span class="k">KEY</span><span class="p">,</span>
<span class="n">field2</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">20</span><span class="p">),</span>
<span class="n">field3</span> <span class="nb">DATE</span><span class="p">,</span>
<span class="n">field3</span> <span class="nb">INT</span><span class="p">,</span>
<span class="n">field4</span> <span class="nb">FLOAT</span><span class="p">);</span>
</code></pre></div></div> <p>Now import the data with LOAD</p> <div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">mysql</span><span class="o">&gt;</span> <span class="k">LOAD</span> <span class="k">DATA</span> <span class="k">LOCAL</span> <span class="n">INFILE</span> <span class="nv">"/path/to/data.csv"</span> <span class="k">INTO</span> <span class="k">TABLE</span> <span class="n">testdb</span><span class="p">.</span><span class="n">mytable</span> <span class="n">FIELDS</span> <span class="n">TERMINATED</span> <span class="k">BY</span> <span class="s1">','</span> <span class="n">LINES</span> <span class="n">TERMINATED</span> <span class="k">BY</span> <span class="s1">'</span><span class="se">\n</span><span class="s1">'</span> <span class="k">IGNORE</span> <span class="mi">1</span> <span class="n">LINES</span> <span class="p">(</span><span class="n">field1</span><span class="p">,</span> <span class="n">field2</span><span class="p">,</span> <span class="o">@</span><span class="n">field3</span><span class="p">,</span> <span class="n">field4</span><span class="p">)</span> <span class="k">set</span> <span class="n">field3</span> <span class="o">=</span> <span class="n">NOW</span><span class="p">();</span>
</code></pre></div></div> <p>Description:<br> column_name data_type(length) [NOT NULL] [DEFAULT value] [AUTO_INCREMENT] column_constraint;</p> <ul> <li>column_name</li> <li>data type and optional size VARCHAR(255)</li> <li>NOT NULL ensures the column will not contain NULL. Other options are CHECK and UNIQUE.</li> <li>DEFAULT is default value for the column.</li> <li>AUTO_INCREMENT col is incremented by one automatically whenever new row is inserted. Each table can only have one AUTO_INCREMENT column.</li> <li>After the column list can define table constraints like UNIQUE, CHECK, PRIMARY KEY and FOREIGN KEY.</li> </ul> <p>To verify</p> <div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">mysql</span><span class="o">&gt;</span> <span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">mytable</span> <span class="k">ORDER</span> <span class="k">BY</span> <span class="n">field1</span><span class="p">;</span>
</code></pre></div></div> <p>or</p> <div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">mysql</span><span class="o">&gt;</span> <span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">mytable</span> <span class="k">limit</span> <span class="mi">10</span><span class="p">;</span>
</code></pre></div></div> <h2 id="ms-access">MS Access</h2> <p>Access makes importing data into excel convenient. You can use PowerQuery to import sheets and transform them. You can also modify tables (add col/rows) with append/merge using the gui and drop down menus vs writing a query.</p> <div class="row"> <div class="col-md mt-3 mt-md-0"> <figure> <picture> <img src="/assets/img/coding/msaccess-query.jpg" class="img-fluid rounded z-depth-1" width="auto" height="auto" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <h1 id="basic-charting">Basic Charting</h1> <p>For time series data I usually use node-red (with its charting options) connected to influxdb. This is the easiest/quickest setup.</p> <h2 id="node-red-chartsgauges">Node-Red Charts/Gauges</h2> <p>Node-red can store/retrieve data from a db like influxdb. Has basic line graphs and charts for monitoring data over time. Options to read/write text files, too</p> <h2 id="grafana">Grafana</h2> <p>Grafana has more advanced charting features. Data from the influxdb can also be accessed thru grafana (geared for time series data)</p> <h1 id="advanced-data-visualization">Advanced Data Visualization</h1> <p>For more advanced data analysis options</p> <ul> <li> <strong>Jupyter notebook</strong> with pandas, numpy, matplotlib, seaborn and dash as the interactive portion.</li> <li> <strong>Power BI</strong> (microsoft windows based). Can import data from databases, csv, JSON, etc and do basic plotting with microsoft tools. Can add R/Python scripts to do more advanced box plots, histograms, heat maps, etc with plotly.</li> <li> <strong>dash</strong> is Python based dashboard using plotly to do advanced box plots, histograms, heat maps.</li> <li> <strong>Python in excel</strong> allows you to enter python code in an excel formula bar and execute it. You can then output the plot or table into your spreadsheet. An advantage of this is you can leverage off pandas to quickly duplicate/transform data tables without changing the original data. You also have access to the python statistical functions. Also if you already have python/jupyter/dash code for reports you can now copy these into excel (or Power BI).</li> <li>streamlit is a quick and easy data visualizations. <h2 id="pandas">Pandas</h2> <p>Pandas is a python library (built on top of NumPy) that provides a tabular structure to your data for most of the advanced data visualization tools. Typically one of the first steps you will do is import your data from a database, spreadsheet, or csv into a pandas dataframe. From here you can easily duplicate the dataframe, modify, create pivots, format columns, add data, etc. An advantage of this is you can easily/quickly transform your data without affecting your original database.</p> </li> </ul> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nc">DataFrame</span><span class="p">(</span><span class="n">client</span><span class="p">.</span><span class="nf">query_api</span><span class="p">().</span><span class="nf">query_data_frame</span><span class="p">(</span><span class="sh">'</span><span class="s">from(bucket: </span><span class="sh">"</span><span class="s">esp2nred</span><span class="sh">"</span><span class="s">) |&gt; range(start: -5d) |&gt; pivot(rowKey:[</span><span class="sh">"</span><span class="s">_time</span><span class="sh">"</span><span class="s">], columnKey: [</span><span class="sh">"</span><span class="s">_field</span><span class="sh">"</span><span class="s">], valueColumn: </span><span class="sh">"</span><span class="s">_value</span><span class="sh">"</span><span class="s">)</span><span class="sh">'</span><span class="p">))</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">.</span><span class="nf">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="sh">'</span><span class="s">result</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">table</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">_start</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">_stop</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">_measurement</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">device</span><span class="sh">'</span><span class="p">])</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">.</span><span class="nf">assign</span><span class="p">(</span><span class="n">date</span><span class="o">=</span><span class="n">df</span><span class="p">[</span><span class="sh">'</span><span class="s">_time</span><span class="sh">'</span><span class="p">].</span><span class="n">dt</span><span class="p">.</span><span class="nf">strftime</span><span class="p">(</span><span class="sh">'</span><span class="s">%Y-%m-%d</span><span class="sh">'</span><span class="p">))</span>
    <span class="n">df</span><span class="p">[</span><span class="sh">'</span><span class="s">date</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nf">to_datetime</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="sh">'</span><span class="s">date</span><span class="sh">'</span><span class="p">])</span>
</code></pre></div></div> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">Results</span> <span class="o">=</span> <span class="n">multi</span><span class="p">.</span><span class="nf">pairwise_tukeyhsd</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="sh">'</span><span class="s">tempf</span><span class="sh">'</span><span class="p">],</span> <span class="n">df</span><span class="p">[</span><span class="sh">'</span><span class="s">location</span><span class="sh">'</span><span class="p">],</span> <span class="n">alpha</span><span class="o">=</span> <span class="mf">0.05</span><span class="p">)</span>  <span class="c1"># Use multi pairwise tukey HSD
</span><span class="n">dftukey</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nc">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">Results</span><span class="p">.</span><span class="n">_results_table</span><span class="p">.</span><span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span> <span class="n">columns</span><span class="o">=</span><span class="n">Results</span><span class="p">.</span><span class="n">_results_table</span><span class="p">.</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">dftukey</span><span class="p">[</span><span class="sh">'</span><span class="s">reject</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="n">dftukey</span><span class="p">[</span><span class="sh">'</span><span class="s">reject</span><span class="sh">'</span><span class="p">].</span><span class="nf">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>
<span class="n">table_tukey</span> <span class="o">=</span> <span class="n">dbc</span><span class="p">.</span><span class="n">Table</span><span class="p">.</span><span class="nf">from_dataframe</span><span class="p">(</span><span class="n">dftukey</span><span class="p">,</span> <span class="n">striped</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">bordered</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">hover</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span> <span class="c1"># use bootstrap formatting on table
</span></code></pre></div></div> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Create summary dataframe with statistics
</span><span class="n">dfsummary</span> <span class="o">=</span> <span class="n">df</span><span class="p">.</span><span class="nf">groupby</span><span class="p">(</span><span class="sh">'</span><span class="s">location</span><span class="sh">'</span><span class="p">)[</span><span class="sh">'</span><span class="s">tempf</span><span class="sh">'</span><span class="p">].</span><span class="nf">describe</span><span class="p">()</span>  <span class="c1"># describe outputs a dataframe
</span><span class="n">dfsummary</span> <span class="o">=</span> <span class="n">dfsummary</span><span class="p">.</span><span class="nf">reset_index</span><span class="p">()</span>  <span class="c1"># this moves the index (locations 1,2,3,4) into a regular column so they show up in the dash table
</span><span class="sh">'''</span><span class="s">dfsummary.style.format({   # this would work if the values were floats. However they
    </span><span class="sh">"</span><span class="s">mean</span><span class="sh">"</span><span class="s">: </span><span class="sh">"</span><span class="s">{:.1f}</span><span class="sh">"</span><span class="s">,         # were strings after the describe functions so had to use
    </span><span class="sh">"</span><span class="s">std</span><span class="sh">"</span><span class="s">: </span><span class="sh">"</span><span class="s">{:.1f}</span><span class="sh">"</span><span class="s">,          # the map function below
})</span><span class="sh">'''</span>
<span class="n">dfsummary</span><span class="p">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="sh">"</span><span class="s">mean</span><span class="sh">"</span><span class="p">]</span> <span class="o">=</span> <span class="n">dfsummary</span><span class="p">[</span><span class="sh">"</span><span class="s">mean</span><span class="sh">"</span><span class="p">].</span><span class="nf">map</span><span class="p">(</span><span class="sh">'</span><span class="s">{:.1f}</span><span class="sh">'</span><span class="p">.</span><span class="nb">format</span><span class="p">)</span>  <span class="c1"># format as float. see comment above
</span><span class="n">dfsummary</span><span class="p">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="sh">"</span><span class="s">std</span><span class="sh">"</span><span class="p">]</span> <span class="o">=</span> <span class="n">dfsummary</span><span class="p">[</span><span class="sh">"</span><span class="s">std</span><span class="sh">"</span><span class="p">].</span><span class="nf">map</span><span class="p">(</span><span class="sh">'</span><span class="s">{:.1f}</span><span class="sh">'</span><span class="p">.</span><span class="nb">format</span><span class="p">)</span>
<span class="n">dfsummary</span><span class="p">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="sh">"</span><span class="s">50%</span><span class="sh">"</span><span class="p">]</span> <span class="o">=</span> <span class="n">dfsummary</span><span class="p">[</span><span class="sh">"</span><span class="s">50%</span><span class="sh">"</span><span class="p">].</span><span class="nf">map</span><span class="p">(</span><span class="sh">'</span><span class="s">{:.1f}</span><span class="sh">'</span><span class="p">.</span><span class="nb">format</span><span class="p">)</span>
<span class="n">dfsummary</span> <span class="o">=</span> <span class="n">dfsummary</span><span class="p">.</span><span class="nf">set_index</span><span class="p">(</span><span class="sh">'</span><span class="s">location</span><span class="sh">'</span><span class="p">).</span><span class="n">T</span><span class="p">.</span><span class="nf">rename_axis</span><span class="p">(</span><span class="sh">'</span><span class="s">location</span><span class="sh">'</span><span class="p">)</span>
<span class="n">dfsummary</span> <span class="o">=</span> <span class="n">dfsummary</span><span class="p">.</span><span class="nf">reset_index</span><span class="p">()</span>
<span class="nf">print</span><span class="p">(</span><span class="n">dfsummary</span><span class="p">)</span>
<span class="n">table_summary</span> <span class="o">=</span> <span class="n">dbc</span><span class="p">.</span><span class="n">Table</span><span class="p">.</span><span class="nf">from_dataframe</span><span class="p">(</span><span class="n">dfsummary</span><span class="p">,</span> <span class="n">striped</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">bordered</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">hover</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span> <span class="c1"># use bootstrap formatting on table
</span></code></pre></div></div> <h2 id="python-in-excel">Python In Excel</h2> <p>Python in excel allows you to enter python code in an excel formula bar and execute it. You can then output the plot or table into your spreadsheet. An advantage of this is you can leverage off pandas to quickly duplicate/transform data tables without changing the original data. You also have access to the python statistical functions. Also if you already have python/jupyter code for reports you can now copy these into excel (or Power BI).</p> <div class="row"> <div class="col-md mt-3 mt-md-0"> <figure> <picture> <img src="/assets/img/coding/Excel-python-boxplot.jpg" class="img-fluid rounded z-depth-1" width="auto" height="auto" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <h2 id="jupyter-notebook">Jupyter Notebook</h2> <p>Jupyter Notebook is easily started from anaconda in either windows, mac, or linux. A typical flow</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="n">IPython.display</span> <span class="kn">import</span> <span class="n">display</span> 
<span class="kn">import</span> <span class="n">pandas</span> <span class="k">as</span> <span class="n">pd</span>
<span class="kn">import</span> <span class="n">numpy</span> <span class="k">as</span> <span class="n">np</span>
<span class="kn">from</span> <span class="n">matplotlib</span> <span class="kn">import</span> <span class="n">pyplot</span> <span class="k">as</span> <span class="n">plt</span>
<span class="kn">import</span> <span class="n">seaborn</span> <span class="k">as</span> <span class="n">sns</span>

<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nf">read_csv</span><span class="p">(</span><span class="sh">"</span><span class="s">data.csv</span><span class="sh">"</span><span class="p">)</span>

<span class="n">pivoted</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nf">pivot_table</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">values</span><span class="o">=</span><span class="sh">'</span><span class="s">data</span><span class="sh">'</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="sh">'</span><span class="s">file</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">sample</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">sensor</span><span class="sh">'</span><span class="p">],</span> <span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="sh">'</span><span class="s">type</span><span class="sh">'</span><span class="p">]).</span><span class="nf">reset_index</span><span class="p">()</span>

<span class="n">pivoted</span><span class="p">.</span><span class="nf">groupby</span><span class="p">([</span><span class="sh">'</span><span class="s">file</span><span class="sh">'</span><span class="p">]).</span><span class="nf">mean</span><span class="p">().</span><span class="nf">round</span><span class="p">(</span><span class="mi">1</span><span class="p">).</span><span class="nf">drop</span><span class="p">([</span><span class="sh">'</span><span class="s">sensor</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">ave</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">delta</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">raw</span><span class="sh">'</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="n">pivoted</span><span class="p">.</span><span class="nf">groupby</span><span class="p">([</span><span class="sh">'</span><span class="s">file</span><span class="sh">'</span><span class="p">]).</span><span class="nf">describe</span><span class="p">().</span><span class="nf">round</span><span class="p">(</span><span class="mi">1</span><span class="p">).</span><span class="nf">drop</span><span class="p">([</span><span class="sh">'</span><span class="s">sensor</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">delta</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">raw</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">ave</span><span class="sh">'</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="c1"># Use melt to unpivot
</span><span class="n">comparedf</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nf">melt</span><span class="p">(</span><span class="n">pivoted</span><span class="p">,</span> <span class="n">id_vars</span><span class="o">=</span><span class="p">[</span><span class="sh">'</span><span class="s">file</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">sample</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">sensor</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">delta</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">time</span><span class="sh">'</span><span class="p">],</span> <span class="n">var_name</span><span class="o">=</span><span class="sh">'</span><span class="s">stat</span><span class="sh">'</span><span class="p">)</span>

<span class="n">a</span> <span class="o">=</span> <span class="n">sns</span><span class="p">.</span><span class="nf">catplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="sh">'</span><span class="s">stat</span><span class="sh">'</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="sh">'</span><span class="s">value</span><span class="sh">'</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="sh">'</span><span class="s">file</span><span class="sh">'</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">comparedf</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="sh">'</span><span class="s">box</span><span class="sh">'</span><span class="p">,</span> <span class="n">ci</span><span class="o">=</span><span class="sh">'</span><span class="s">sd</span><span class="sh">'</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="nf">show</span><span class="p">()</span>

<span class="n">b</span> <span class="o">=</span> <span class="n">sns</span><span class="p">.</span><span class="nf">catplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="sh">'</span><span class="s">stat</span><span class="sh">'</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="sh">'</span><span class="s">value</span><span class="sh">'</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">comparedf</span><span class="p">,</span> <span class="n">hue</span><span class="o">=</span><span class="sh">'</span><span class="s">sensor</span><span class="sh">'</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="sh">'</span><span class="s">file</span><span class="sh">'</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="sh">'</span><span class="s">strip</span><span class="sh">'</span><span class="p">)</span>

<span class="c1"># More seaborn options
</span><span class="n">fig</span><span class="p">,</span><span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="p">.</span><span class="nf">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span> <span class="n">sharex</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">sharey</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">squeeze</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="n">g</span> <span class="o">=</span> <span class="n">sns</span><span class="p">.</span><span class="nf">boxplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="sh">'</span><span class="s">file</span><span class="sh">'</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="sh">'</span><span class="s">time</span><span class="sh">'</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">pivoted</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="c1">#g.set(ylim=(1500, 2250)) g.set_title('ADC Time') g.set_ylabel('time (ms)')
#plt.title('ADC Average')
#plt.ylim(1500, 2250)
#h = sns.boxplot(x='file', y='raw', data=pivoted, ax=axs[1])
#h.set_title('ADC Raw') #plt.title('ADC Raw')
#plt.ylim(1500, 2250)
#h.set(ylim=(1500, 2250))
#h.set_ylabel('raw')
</span><span class="n">plt</span><span class="p">.</span><span class="nf">show</span><span class="p">()</span>

<span class="c1"># Histogram
</span>
<span class="n">pi0df</span> <span class="o">=</span> <span class="n">pivoted</span><span class="p">[</span><span class="n">pivoted</span><span class="p">[</span><span class="sh">'</span><span class="s">file</span><span class="sh">'</span><span class="p">]</span> <span class="o">==</span> <span class="sh">'</span><span class="s">pi0</span><span class="sh">'</span><span class="p">]</span>
<span class="n">esp32df</span> <span class="o">=</span> <span class="n">pivoted</span><span class="p">[</span><span class="n">pivoted</span><span class="p">[</span><span class="sh">'</span><span class="s">file</span><span class="sh">'</span><span class="p">]</span> <span class="o">==</span> <span class="sh">'</span><span class="s">esp32</span><span class="sh">'</span><span class="p">]</span>
<span class="n">sns</span><span class="p">.</span><span class="nf">distplot</span><span class="p">(</span><span class="n">pi0df</span><span class="p">[</span><span class="n">pi0df</span><span class="p">[</span><span class="sh">'</span><span class="s">sensor</span><span class="sh">'</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">].</span><span class="n">raw</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sh">'</span><span class="s">pi0-ch0</span><span class="sh">'</span><span class="p">)</span>
<span class="n">sns</span><span class="p">.</span><span class="nf">distplot</span><span class="p">(</span><span class="n">pi0df</span><span class="p">[</span><span class="n">pi0df</span><span class="p">[</span><span class="sh">'</span><span class="s">sensor</span><span class="sh">'</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">].</span><span class="n">raw</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sh">'</span><span class="s">pi0-ch1</span><span class="sh">'</span><span class="p">)</span> <span class="n">sns</span><span class="p">.</span><span class="nf">distplot</span><span class="p">(</span><span class="n">esp32df</span><span class="p">[</span><span class="n">esp32df</span><span class="p">[</span><span class="sh">'</span><span class="s">sensor</span><span class="sh">'</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">].</span><span class="n">raw</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sh">'</span><span class="s">esp32-ch0</span><span class="sh">'</span><span class="p">)</span> <span class="n">sns</span><span class="p">.</span><span class="nf">distplot</span><span class="p">(</span><span class="n">esp32df</span><span class="p">[</span><span class="n">esp32df</span><span class="p">[</span><span class="sh">'</span><span class="s">sensor</span><span class="sh">'</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">].</span><span class="n">raw</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sh">'</span><span class="s">esp32-ch1</span><span class="sh">'</span><span class="p">)</span>
<span class="c1">#fig.legend(labels=['pi0-ch0','pi0-ch1','esp32-ch0','exp32-ch1'])
</span><span class="n">plt</span><span class="p">.</span><span class="nf">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="p">.</span><span class="nf">show</span><span class="p">()</span>

<span class="err">​</span><span class="c1"># Seaborn categorical plot. kind="box"
</span><span class="n">i</span> <span class="o">=</span> <span class="n">sns</span><span class="p">.</span><span class="nf">catplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="sh">"</span><span class="s">file</span><span class="sh">"</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="sh">"</span><span class="s">time</span><span class="sh">"</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">pivoted</span><span class="p">,</span> <span class="n">ci</span><span class="o">=</span><span class="sh">'</span><span class="s">sd</span><span class="sh">'</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="sh">"</span><span class="s">box</span><span class="sh">"</span><span class="p">)</span>
</code></pre></div></div> <div class="row"> <div class="col-md mt-3 mt-md-0"> <figure> <picture> <img src="/assets/img/coding/jupyter.jpg" class="img-fluid rounded z-depth-1" width="auto" height="auto" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <h2 id="dash-plotly">Dash-plotly</h2> <p>Dash gives more GUI type functions, ie letting a user toggle data series on/off while plotting.<br> <code class="language-plaintext highlighter-rouge">$ python3 -m pip install dash</code></p> <p>You will create a file called app.py that contains the dash/plotly code.<br> When you run<br> <code class="language-plaintext highlighter-rouge">$ python3 app.py</code><br> It will create a link to view the charts in your browser</p> <p><strong>Primary components</strong><br> (initial chart can be plotted with steps 1-3 alone)</p> <ol> <li>Load css and create dash object</li> <li>Define figures (charts. ie fig = px.histogram(df, x=”values”, nbins=1 ), optional text string (markdown), functions(ie to show the data/df)</li> <li>Layout (see below.. will use html and core components)</li> <li>Callbacks (not required but can be used for interactive charts)</li> </ol> <p><strong>More details</strong></p> <ul> <li>Layout is a hierarchical tree (dash_html_components)</li> <li>Use html components (classes for HTML tags) to create the layout (ie html.DIV, style, etc).</li> <li>To place charts use dash_core_components: dcc.Graph(figure=fig)</li> </ul> <p><strong>Callbacks</strong><br> Callbacks allow for input/output. Makes the charts dynamic and gives you more options for control in the web interface (from dash.dependencies import Input, Output)</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@app.callback</span><span class="p">(</span><span class="nc">Output</span><span class="p">(</span><span class="n">output_args</span><span class="p">),</span> <span class="nc">Input</span><span class="p">(</span><span class="n">input_args</span><span class="p">))</span>
<span class="k">def</span> <span class="nf">generateChart</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">):</span>
   <span class="n">fig</span> <span class="o">=</span> <span class="n">px</span><span class="p">.</span><span class="nf">box</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="p">)</span>
   <span class="k">return</span> <span class="n">fig</span>
</code></pre></div></div> <p>Packages to import</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="n">dash</span>
<span class="kn">import</span> <span class="n">dash_core_components</span> <span class="k">as</span> <span class="n">dcc</span>
<span class="kn">import</span> <span class="n">dash_html_components</span> <span class="k">as</span> <span class="n">html</span>
<span class="kn">from</span> <span class="n">dash.dependencies</span> <span class="kn">import</span> <span class="n">Input</span><span class="p">,</span> <span class="n">Output</span>
<span class="kn">import</span> <span class="n">plotly.express</span> <span class="k">as</span> <span class="n">px</span>
<span class="kn">import</span> <span class="n">pandas</span> <span class="k">as</span> <span class="n">pd</span>
</code></pre></div></div> <div class="row"> <div class="col-md mt-3 mt-md-0"> <figure> <picture> <img src="/assets/img/coding/dash.jpg" class="img-fluid rounded z-depth-1" width="auto" height="auto" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <h2 id="power-bi">Power BI</h2> <p>Power BI (microsoft windows based) is great for clean visualization in a presentation/powerpoint style. It is geared for presenting. It can import data from databases, csv, JSON, etc and do basic plotting with microsoft tools. Can add R/Python scripts to do more advanced box plots, histograms, heat maps, etc with plotly. Only supports importing from pandas (df).</p> <div class="row"> <div class="col-md mt-3 mt-md-0"> <figure> <picture> <img src="/assets/img/coding/PowerBI-python-boxplot.jpg" class="img-fluid rounded z-depth-1" width="auto" height="auto" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <h1 id="workflow">Workflow</h1> <p>This is my general workflow I follow for projects. I often start with RPi/Python and then translate it to esp32/uPython.</p> <p>For comparing different hardware options (RPi vs esp32) and power supply/memory considerations start at the hardware section.</p> <p>If setting up a new Raspberry Pi for the project.</p> <ol> <li>Use RPi imager to install the Raspberry Pi OS. (I usually install the full version and then remove programs I do not need.) Click on the options for RPi imager and you can enter setup info like a unique hostname, wifi info, etc. This makes it easier to setup without a monitor.</li> <li>Plug the RPi and go through the setup screens.</li> <li>Go to ‘Raspberry Pi Configuration’ Menu and ‘Interfaces’ and turn on SSH/VNC for remote Pi operation (may also need to turn on SPI, I2C, or 1-wire, depending on the hardware you’re connecting). After reboot you can note the IP address and use it with RealVNC viewer to connect remotely from a desktop PC/laptop. (Giving the RPi a unique hostname and using it is useful since the IP address will not stay constant. Or set-up a RealVNC connect account and connect even from a different wi-fi. Free for Raspberry Pi)</li> <li>To free up space and minimize the time required for updates remove programs that are seldom used. See bottom of my list of software page. Before installing programs/packages it is always a good idea to do an update ($ sudo apt update &amp;&amp; sudo apt upgrade)</li> <li>(optional - to change the RPi appearance/desktop and/or customize the desktop start at RPi options. For details on how installing packages work continue on to software package section)</li> <li>gdebi is what I use for installing DEB packages ($ sudo apt install gdebi)</li> <li>VScode is the main editor I use.</li> <li>Git is what I use for maintaining project code (follow setup of ssh key if you’re going to maintain the code on github).</li> </ol> <h2 id="hardware">Hardware</h2> <p>Hardware/Circuits/Sensors/Peripherals - Adafruit libraries are what I primarily use to simplify getting data from sensors (Adafruit also has a line of SBCs and useful parts/circuits for projects). The libraries are primarily written in circuitpython to work with Adafruit SBCs but they also have a Python/RaspberryPi compatability tool called <a href="https://learn.adafruit.com/circuitpython-on-raspberrypi-linux" target="_blank" rel="noopener noreferrer">blinka</a> that will install <strong>board</strong> module. Most projects will use either Raspberry Pi specific GPIO libraries called <a href="https://sourceforge.net/projects/raspberry-gpio-python/" target="_blank" rel="noopener noreferrer">RPi.GPIO</a>, which are installed on RPis by default, or more generic <a href="https://learn.adafruit.com/adding-a-single-board-computer-to-blinka/software-setup" target="_blank" rel="noopener noreferrer">gpiod</a> C library/tools for working with Linux GPIO hardware. gpiod is the tools, libgpiod2 is the library, python3-libgpiod allows Python to use the library.<br> <code class="language-plaintext highlighter-rouge">sudo apt-get install libgpiod2 python3-libgpiod gpiod</code></p> <p>For simple gpio functions like turning an led on/off I will use <a href="https://gpiozero.readthedocs.io/en/stable/" target="_blank" rel="noopener noreferrer">gpiozero</a>. gpiozero is an interface that simplifies the code for working with the pins. If you’re not working in a virtual environment then gpiozero can use the RPi.GPIO modules, installed on RPi by default, or <a href="http://abyz.me.uk/rpi/pigpio/download.html" target="_blank" rel="noopener noreferrer">pigpio</a> modules for the pin factory. However when working in a venv I’ve noticed I have to specifally use pip3 to install RPi.GPIO (or pigpio) in my env for gpiozero to see the modules.</p> <p>Also when possible check that hardware/circuits work before soldering or trying to control it with software. Some examples</p> <ol> <li>Connect LED to 3.3V and confirm it lights up.</li> <li>Use a servo tester to confirm the servo motors work.</li> <li>Use alligator clips to hook up a 18650 battery to a li ion charger and the device it will power. Confirm charging/discharging works. I’ve come across multiple bad chargers. They work fine with no load but would shut off with even .25 Watt load.</li> <li>The hardware trouble shooting section is good to understand before moving on to more advanced projects.</li> <li>For I2C make sure tools installed <ul> <li><code class="language-plaintext highlighter-rouge">​sudo apt install -y python-smbus</code></li> <li><code class="language-plaintext highlighter-rouge">sudo apt install -y i2c-tools</code></li> </ul> </li> </ol> <p>​</p> <h2 id="coding">Coding</h2> <ol> <li>Initialize an empty github repository</li> <li>Select the option to create the README and .gitignore (python template) github</li> <li>Copy the ssh link under Code</li> <li>Clone the empty repository - Cloning can either be done inside an editor like VScode or going to the RPi the project will be done on (often using vnc) and clone the repo with $ git clone git@github.com:user/repo.git (ssh link copied from github). Or inside VScode connect to your github account, remote to the RPi and in the pallette type git clone. Search for the repository and select the location to clone to.</li> <li>Start Coding - The setup I’ve found myself using most is VScode. I use the VScode remote connection extension to connect to the RPi’s and code from another linux/windows PC. (The exception is Pi0. The VScode remote extension does not work on Pi0. So for Pi0 projects I configure the Pi0 git project folder as a samba share and use a txt editor to work on the code from a PC.)</li> <li>In VScode remote connect to the RPi3-4</li> <li>Open the cloned github folder and confirm .gitignore is setup.</li> <li>Open the terminal and create virtual env. Can install/use other python, ie python3.7</li> <li>$ python3.7 -m venv .venv</li> <li>$ source .venv/bin/activate and confirm Python (.venv) interpreter selected in bottom</li> <li>Install any required packages. ie $ python3.7 -m pip install ‘package’</li> </ol> <p>Get first pass, functional code working on “main” branch<br> Code, test, code, test, etc</p> <ul> <li>I use the git commit/syncronize to keep the code uploaded to github. This keeps a backup and makes it easier to transfer and test on other devices.</li> <li>Add functionality by creating a develop branch and merging it back with the main when complete. (see functionality section below)</li> <li>If using a venv and need the program to run outside of the venv environment (ie need it to run on startup) then make sure to update the shebang #! header of your python file to point to the python path in your venv. Example #!/home/pi/projectA/.venv/bin/python3</li> <li>You can then make it executable with $ chmod +x filename.py</li> <li>Now you can run the program with $ ./filename.py</li> </ul> <p>​​</p> <h2 id="mqttserversdb">MQTT/Servers/DB</h2> <p>Sending commands, collecting data - Most projects involve remote commands, sending instructions, and collecting data. I use mqtt, node-red, influxdb for this. I have a Pi3B dedicated as a mqtt/node-red server. Login at hostname.local:1880 and create node-red flows. (* I give each Pi a different hostname and use hostname.local instead of IP address when possible. The IP address can be problematic when switching from stand alone to wifi connected)</p> <h2 id="esp32upython">esp32/uPython</h2> <p>Translate to esp32 - In the git folder create a /upython folder and copy boilerplate/template main.py code for whatever type of project. The esp32 will be connected to USB port. Two options below for coding esp32. Both have pros/cons.</p> <ol> <li>RPi and Thonny - Remote connect from a PC and using Thonny copy code from the upython folder to the esp32. Code, test, code, test, etc. ​When completed copy the code from esp32 back to git project folder and sync using VScode.​​</li> <li>Linux PC and VScode with Pymakr. Can use VScode to edit and sync directly</li> </ol> <h2 id="run-at-startup">Run at Startup</h2> <p>There are multiple methods to enable a program to run at startup. For a full list check the <a href="../../../ref/linux/autostart/">autostart/start-on-boot</a> section. If using a virtual env; to statisfy dependencies make sure your python program has a shebang header pointing to the python path in your virtual env. example.</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="go">!/home/pi/project_dir/.venv/bin/python3 
</span></code></pre></div></div> <p>And make the program executable with <code class="language-plaintext highlighter-rouge">sudo chmod +x program.py</code></p> <p>A quick systemd setup can look like this<br> <code class="language-plaintext highlighter-rouge">sudo nano /lib/systemd/system/program_name.service</code></p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="go">[Unit]
Description=Python Program to Run at Startup

[Service]
User=pi
Group=pi

ExecStart=/home/pi/project_dir/program.py
Restart=on-failure

[Install]
WantedBy=multi-user.target
</span></code></pre></div></div> <p><strong>Call graph</strong> A call graph can be helpful to visually see which functions are calling which functions.</p> <ol> <li>Install graphviz $ sudo apt install graphviz or can try linuxbrew</li> <li>In activated venv install project graph $ python3x -m pip install git+https://github.com/fior-di-latte/project_graph.git</li> <li>Inside project directory run $ project_graph your-program.py</li> <li>A .png file should be created.</li> <li>If a graph.dot is created but no .png then try $ dot -Tpng graph.dot &gt; output.png</li> </ol> <p>​ Another method is pycallgraph2</p> <ol> <li>Install graphviz $ sudo apt install graphviz or can try linuxbrew</li> <li>In activated venv install graphviz $ python3x -m pip install pycallgraph2</li> <li>Inside project directory run $ pycallgraph graphviz – ./mypythonscript.py</li> </ol> <h2 id="git-branches">​Git branches</h2> <p>If you will be adding features use git branches. “main” will be the default primary code. Work on main branch until you have preliminary working code (useful to test initial functions and confirm everything is operating)</p> <p>​Add More Functionality (branch from develop)<br> To keep your initial main branch in-tact while working on features create a permanent develop branch that you branch off of.</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ git checkout -b develop main (branch off from develop for features)
</code></pre></div></div> <p>Now create branches for features</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ git checkout -b feature1 develop (creates feature branch and checks it out)
Can create and work on multiple features and make commits
</code></pre></div></div> <p>When finished, merge the feature back into develop branch</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ git checkout develop (switch from feature back to develop)
$ git merge --no-ff feature1 (merge develop and feature1)
$ git branch -d feature1 (delete the feature1 branch)
$ git push origin develop (update the remote repo)
</code></pre></div></div> <p>When you’ve completed all features and want to update main</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ git checkout main
$ git merge develop
</code></pre></div></div> <p>Bug Fixes (branch from main)</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ git checkout -b hotfix1 main (creates hotfix branch and checks it out)
Can work on the bug and make commits
</code></pre></div></div> <p>Merge the bug fix back into main and develop branch</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ git checkout main
$ git merge --no-ff hotfix1
$ git checkout develop
$ git merge --no-ff hotfix1
$ git push origin develop (update the remote repo)
$ git push origin main (update the remote repo)
$ git branch -d hotfix1 (delete the hotfix branch)
</code></pre></div></div> <p>​ Other helpful commands​ <code class="language-plaintext highlighter-rouge">(.venv)$ python3 -m pydoc -n IPaddress (browse thru the installed package/modules)</code><br> (IPaddress = 0.0.0.0)<br> To find files use <code class="language-plaintext highlighter-rouge">grep -r 'name' .</code> <br> ​To browse pi use<br> <code class="language-plaintext highlighter-rouge">python3 -m http.server​</code></p> <blockquote> <p>If you have a monitor hooked up to the RPi (or VNC) you can use VScode for a gui alternative to many of the command lines. Will also want to make sure you have a keyring setup with VScode for git functions. <code class="language-plaintext highlighter-rouge">nano .gitconfig</code> (confirm your git setup)<br> Inside VScode ```console F1 Git: Clone Clone from GitHub A list of your repositories will come up. Select the Repository and the folder to clone it in.</p> </blockquote> <p>Now you can do New Terminal, create/activate .venv and install from requirements.txt</p> <p>(if using vscode ssh for remote work may need to install python extension after connecting) ```</p> <h2 id="copy-project">Copy Project</h2> <p>To transfer project to another system<br> Output the python packages required to a requirements.txt file<br> (.venv)$ pip3 freeze &gt; requirements.txt​<br> or $ python3 -m pip3 freeze &gt; requirements.txt</p> <p>Confirm the git remote and push to github $ git remote -v $ git add . $ git commit -m “message details” $ git push -u origin main (or $ git push)</p> <p>Go to new device/location $ git clone git@github.com:user/repo.git (ssh copied from github)</p> <p>Create/activate a .venv $ python3 -m venv .venv $ source .venv/bin/activate install with -r for requirement install (.venv)$pip3 install -r requirements.txt or $ python3 -m pip3 install -r requirements.txt</p> <p>​(if using vscode ssh for remote work may need to install python extension after connecting)</p> <h2 id="create-python-package">Create Python Package</h2> <p>​Python Package - If the code/project will be used in many other projects create it as a package that you can import. This will keep your main code more organized and smaller.</p> <ol> <li>Create a package folder with <strong>init</strong>.py</li> <li> <strong>init</strong>.py - There are multiple approaches to the import <ul> <li>import package.module</li> <li>from .module import classA</li> </ul> </li> <li>Put the module code in the package folder and use <strong>name</strong> == “<strong>main</strong>”: to run module as stand alone script.</li> <li>For the top script use appropriate import based on package <strong>init</strong> (1:from package import module as xx or 2:import package)</li> <li>Call the functions (var=xx.function() var = package.classA())​</li> </ol> <p>(../../../ref/coding/starting-up/)</p> <div class="row"> <div class="col-md mt-3 mt-md-0"> <figure> <picture> <img src="/assets/img/coding/flappybird.png" class="img-fluid rounded z-depth-1" width="auto" height="auto" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <div class="row justify-content-center float-right"> <div class="col-4-auto mt-3 mt-md-0"> <figure> <picture> <img src="/assets/img/coding/flappybird.png" class="img-fluid rounded z-depth-1" width="auto" height="auto" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <hr> <p>Images can you col-# col-sm-# col-md-# col-lg-# Use auto to auto size around image Just wrap your images with <code class="language-plaintext highlighter-rouge">&lt;div class="col-sm"&gt;</code> and place them inside <code class="language-plaintext highlighter-rouge">&lt;div class="row"&gt;</code> (read more about the <a href="https://getbootstrap.com/docs/4.4/layout/grid/" target="_blank" rel="noopener noreferrer">Bootstrap Grid</a> system).</p> </article> </div> </main> </div> </div> <footer class="fixed-bottom"> <div class="container mt-0"> © Copyright 2023 Sean Trautman. Powered by <a href="https://jekyllrb.com/" target="_blank" rel="noopener noreferrer">Jekyll</a>. Hosted by <a href="https://pages.github.com/" target="_blank" rel="noopener noreferrer">GitHub Pages</a>. </div> </footer> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/js/bootstrap.bundle.min.js" integrity="sha256-fgLAgv7fyCGopR/gBNq2iW3ZKIdqIcyshnUULC4vex8=" crossorigin="anonymous"></script> <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/masonry-layout@4.2.2/dist/masonry.pkgd.min.js" integrity="sha256-Nn1q/fx0H7SNLZMQ5Hw5JLaTRZp0yILA/FRexe19VdI=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/imagesloaded@4/imagesloaded.pkgd.min.js"></script> <script defer src="/assets/js/masonry.js" type="text/javascript"></script> <script defer src="https://cdn.jsdelivr.net/npm/medium-zoom@1.0.6/dist/medium-zoom.min.js" integrity="sha256-EdPgYcPk/IIrw7FYeuJQexva49pVRZNmt3LculEr7zM=" crossorigin="anonymous"></script> <script defer src="/assets/js/zoom.js"></script> <script defer src="/assets/js/common.js"></script> <script type="text/javascript">window.MathJax={tex:{tags:"ams"}};</script> <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.0/es5/tex-mml-chtml.js"></script> <script defer src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script> <script type="text/javascript">function progressBarSetup(){"max"in document.createElement("progress")?(initializeProgressElement(),$(document).on("scroll",function(){progressBar.attr({value:getCurrentScrollPosition()})}),$(window).on("resize",initializeProgressElement)):(resizeProgressBar(),$(document).on("scroll",resizeProgressBar),$(window).on("resize",resizeProgressBar))}function getCurrentScrollPosition(){return $(window).scrollTop()}function initializeProgressElement(){let e=$("#navbar").outerHeight(!0);$("body").css({"padding-top":e}),$("progress-container").css({"padding-top":e}),progressBar.css({top:e}),progressBar.attr({max:getDistanceToScroll(),value:getCurrentScrollPosition()})}function getDistanceToScroll(){return $(document).height()-$(window).height()}function resizeProgressBar(){progressBar.css({width:getWidthPercentage()+"%"})}function getWidthPercentage(){return getCurrentScrollPosition()/getDistanceToScroll()*100}const progressBar=$("#progress");window.onload=function(){setTimeout(progressBarSetup,50)};</script> </body> </html>